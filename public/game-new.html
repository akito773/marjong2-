<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€„ æœ¬æ ¼éº»é›€ v1.2.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #1a5f2f 0%, #0f4021 50%, #0a2d17 100%);
            color: #212529;
            height: 100vh;
            overflow: hidden;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .game-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            height: 60px;
        }

        .game-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffc107;
        }

        .game-info {
            display: flex;
            align-items: center;
            gap: 20px;
            color: white;
            font-size: 0.9rem;
        }

        .game-controls {
            display: flex;
            gap: 10px;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ */
        .mahjong-container {
            height: 100vh;
            padding-top: 60px;
            display: flex;
            flex-direction: column;
        }

        /* ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ï¼ˆä¸­å¤®ã‚¨ãƒªã‚¢ï¼‰ */
        .game-board {
            flex: 1;
            background: linear-gradient(135deg, #2d5a3d 0%, #1a4c2c 100%);
            border-radius: 20px;
            margin: 20px;
            position: relative;
            border: 8px solid #8b4513;
            box-shadow: 0 0 0 4px #ffc107, 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é…ç½® */
        .player-area {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .player-area.current {
            border-color: #ffc107;
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.5);
        }

        /* ä¸Šå´ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆå¯¾é¢ï¼‰ */
        .player-top {
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        /* å³å´ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
        .player-right {
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            text-align: center;
        }

        /* å·¦å´ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
        .player-left {
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            text-align: center;
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ± */
        .player-info {
            color: white;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .player-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .player-wind {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            display: inline-block;
        }

        /* æ‰‹ç‰Œè¡¨ç¤º */
        .hand-tiles {
            display: flex;
            gap: 2px;
            flex-wrap: nowrap;
        }

        /* å¯¾æˆ¦ç›¸æ‰‹ã®æ‰‹ç‰Œï¼ˆè£å‘ãï¼‰ */
        .opponent-tiles {
            display: flex;
            gap: 2px;
        }

        .opponent-tile {
            width: 20px;
            height: 28px;
            background: #4a5568;
            border: 1px solid #2d3748;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
        }

        /* å·¦å³ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ç¸¦å‘ã */
        .player-left .opponent-tiles, 
        .player-right .opponent-tiles {
            flex-direction: column;
        }

        .player-left .opponent-tile, 
        .player-right .opponent-tile {
            width: 28px;
            height: 20px;
        }

        /* æœ¬æ ¼éº»é›€ã®æ²³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .mahjong-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .rivers-horizontal {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex: 1;
        }

        .river-area {
            display: grid;
            gap: 1px;
            padding: 4px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 6px;
        }

        /* ä¸Šä¸‹ã®æ²³ï¼ˆæ¨ªå‘ã6Ã—3ï¼‰ */
        .river-top, .river-bottom {
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(3, 1fr);
            width: 150px;
            height: 60px;
            margin: 0 auto;
        }

        /* å·¦å³ã®æ²³ï¼ˆç¸¦å‘ã3Ã—6ï¼‰ */
        .river-left, .river-right {
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(6, 1fr);
            width: 60px;
            height: 150px;
        }

        /* æ²³ã®ç‰Œã‚¹ã‚¿ã‚¤ãƒ« */
        .river-tile {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: 600;
            cursor: default;
            min-width: 18px;
            min-height: 18px;
        }

        .river-tile.red {
            color: #dc3545;
        }

        .river-tile.reach {
            transform: rotate(90deg);
            background: #ffe6e6;
            border-color: #ff9999;
        }

        /* ä¸­å¤®æƒ…å ±ã‚¨ãƒªã‚¢ */
        .center-info {
            color: white;
            text-align: center;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 15px;
            min-width: 120px;
        }

        .round-info {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffc107;
            margin-bottom: 8px;
        }

        .dora-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            margin-bottom: 8px;
        }

        .remaining-tiles {
            font-size: 0.7rem;
            color: #ccc;
        }

        /* ä¸‹éƒ¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ²³ã¯é€†é †é…ç½® */
        .river-bottom {
            direction: rtl;
        }

        .river-bottom .river-tile {
            direction: ltr;
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ï¼ˆä¸‹éƒ¨ï¼‰ */
        .player-bottom-area {
            background: rgba(255, 255, 255, 0.95);
            margin: 0 20px 20px 20px;
            border-radius: 12px;
            padding: 15px;
            border: 3px solid #ffc107;
        }

        .player-hand-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .player-details {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .hand-count {
            font-size: 0.9rem;
            color: #6c757d;
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰‹ç‰Œ */
        .player-hand {
            display: flex;
            gap: 4px;
            justify-content: flex-start;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .tile {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            padding: 8px 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 40px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            user-select: none;
        }

        .tile:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            background: #f8f9fa;
        }

        .tile.selected {
            background: #fff3cd;
            border-color: #ffc107;
            transform: translateY(-6px);
            box-shadow: 0 6px 12px rgba(255, 193, 7, 0.4);
        }

        .tile.red {
            color: #dc3545;
            font-weight: 800;
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ¨ã¦ç‰Œ */
        .player-discards {
            border-top: 1px solid #dee2e6;
            padding-top: 10px;
        }

        .player-discards-title {
            font-size: 0.8rem;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .player-discard-tiles {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
        }

        .player-discard-tiles .tile {
            width: 28px;
            height: 36px;
            font-size: 14px;
            cursor: default;
            background: #e9ecef;
            border-color: #ced4da;
        }

        .player-discard-tiles .tile:hover {
            transform: none;
            background: #e9ecef;
        }

        /* å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å€‹åˆ¥æ¨ç‰Œã‚¨ãƒªã‚¢ */
        .player-discard-area {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 2px;
            margin-top: 8px;
            padding: 6px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            min-height: 50px;
            max-width: 150px;
        }

        .player-top .player-discard-area {
            margin-top: 8px;
        }

        .player-left .player-discard-area,
        .player-right .player-discard-area {
            margin-top: 8px;
            max-width: 120px;
        }

        .player-discard-area .discard-tile {
            font-size: 9px;
            padding: 1px;
            min-width: 20px;
            height: 24px;
            cursor: default;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .player-discard-area .discard-tile:hover {
            transform: none;
            background: #f8f9fa;
        }

        .player-discard-area .discard-tile.red {
            color: #dc3545;
            font-weight: 800;
        }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .action-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            max-width: 300px;
            z-index: 50;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .btn-primary { background: #007bff; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-success { background: #198754; color: white; }
        .btn-info { background: #0dcaf0; color: #212529; }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* æƒ…å ±ãƒ‘ãƒãƒ« */
        .info-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 250px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 50;
        }

        .game-status {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #212529;
        }

        .game-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #6c757d;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #212529;
        }

        /* é€šçŸ¥ */
        .notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .notification.show {
            opacity: 1;
        }

        .notification.success {
            background: #d1edff;
            color: #0c63e4;
        }

        .notification.error {
            background: #f8d7da;
            color: #721c24;
        }

        .notification.warning {
            background: #fff3cd;
            color: #856404;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .game-board {
                margin: 10px;
            }
            
            .info-panel {
                position: relative;
                top: auto;
                right: auto;
                width: 100%;
                margin: 10px;
            }
            
            .action-panel {
                position: relative;
                bottom: auto;
                right: auto;
                max-width: none;
                margin: 10px;
                justify-content: center;
            }

            .player-bottom-area {
                margin: 0 10px 10px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="mahjong-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="game-header">
            <a href="/title.html" class="game-title" style="text-decoration: none;">ğŸ€„ æœ¬æ ¼éº»é›€ v1.2.0</a>
            
            <div class="game-info">
                <div id="gameInfo">æ±å ´ 1å±€</div>
                <div>æ®‹ã‚Šç‰Œ: <span id="remainingTiles">69</span></div>
                <div>ç¾åœ¨: <span id="currentPlayerName">ã‚ãªãŸ</span></div>
            </div>

            <div class="game-controls">
                <button class="btn btn-info" onclick="toggleDebug()">ãƒ‡ãƒãƒƒã‚°</button>
                <button class="btn btn-warning" onclick="newGame()">æ–°ã—ã„ã‚²ãƒ¼ãƒ </button>
                <a href="/title.html" class="btn btn-info">ã‚¿ã‚¤ãƒˆãƒ«</a>
            </div>
        </header>

        <!-- ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ -->
        <div class="game-board">
            <!-- ä¸Šå´ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆå¯¾é¢ï¼‰ -->
            <div class="player-area player-top" id="player2">
                <div class="player-info">
                    <div class="player-name">CPUè¥¿</div>
                    <div class="player-wind">è¥¿</div>
                </div>
                <div class="opponent-tiles" id="hand2"></div>
            </div>

            <!-- å³å´ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
            <div class="player-area player-right" id="player3">
                <div class="player-info">
                    <div class="player-name">CPUåŒ—</div>
                    <div class="player-wind">åŒ—</div>
                </div>
                <div class="opponent-tiles" id="hand3"></div>
            </div>

            <!-- å·¦å´ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
            <div class="player-area player-left" id="player1">
                <div class="player-info">
                    <div class="player-name">CPUå—</div>
                    <div class="player-wind">å—</div>
                </div>
                <div class="opponent-tiles" id="hand1"></div>
            </div>

            <!-- ä¸­å¤®ã®æ²³ã‚¨ãƒªã‚¢ï¼ˆæœ¬æ ¼éº»é›€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ -->
            <div class="mahjong-center">
                <!-- ä¸Šå´ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ²³ -->
                <div class="river-area river-top" id="river2"></div>
                
                <!-- å·¦å³ã®æ²³ã¨ä¸­å¤®æƒ…å ± -->
                <div class="rivers-horizontal">
                    <!-- å·¦å´ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ²³ -->
                    <div class="river-area river-left" id="river1"></div>
                    
                    <!-- ä¸­å¤®æƒ…å ±ã‚¨ãƒªã‚¢ -->
                    <div class="center-info">
                        <div class="round-info" id="roundInfo">æ±1å±€</div>
                        <div class="dora-info">
                            ãƒ‰ãƒ©: <span id="doraIndicator">ğŸ€«</span>
                        </div>
                        <div class="remaining-tiles">
                            æ®‹ã‚Š: <span id="remainingTilesDisplay">69</span>æš
                        </div>
                    </div>
                    
                    <!-- å³å´ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ²³ -->
                    <div class="river-area river-right" id="river3"></div>
                </div>
                
                <!-- ä¸‹å´ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ²³ -->
                <div class="river-area river-bottom" id="river0"></div>
            </div>
        </div>

        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ï¼ˆä¸‹éƒ¨ï¼‰ -->
        <div class="player-bottom-area" id="player0">
            <div class="player-hand-header">
                <div class="player-details">
                    <div class="player-name" id="playerName">ã‚ãªãŸ</div>
                    <div class="player-wind" id="playerWind">æ±</div>
                    <div style="color: #6c757d; font-size: 0.9rem;">
                        <span id="playerScore">25000</span>ç‚¹
                    </div>
                </div>
                <div class="hand-count">
                    æ‰‹ç‰Œ: <span id="handCount">13</span>æš
                </div>
            </div>
            
            <div class="player-hand" id="hand0"></div>
            
        </div>

        <!-- æƒ…å ±ãƒ‘ãƒãƒ« -->
        <div class="info-panel">
            <div class="game-status" id="gameStatus">ã‚²ãƒ¼ãƒ é–‹å§‹</div>
            <div class="game-stats">
                <div class="stat-item">
                    <div class="stat-label">ç¾åœ¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</div>
                    <div class="stat-value" id="currentPlayer">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å±€æ•°</div>
                    <div class="stat-value" id="round">1</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">æœ¬å ´</div>
                    <div class="stat-value" id="honba">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">æ®‹ã‚Šç‰Œ</div>
                    <div class="stat-value" id="remainingTilesInfo">69</div>
                </div>
            </div>
            <button class="btn btn-success" onclick="requestGameState()" style="width: 100%;">
                çŠ¶æ…‹ã‚’æ›´æ–°
            </button>
        </div>

        <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ãƒãƒ« -->
        <div class="action-panel">
            <button class="btn btn-primary" onclick="drawTile()" id="drawBtn">ãƒ„ãƒ¢</button>
            <button class="btn btn-danger" onclick="discardSelected()" id="discardBtn">æ‰“ç‰Œ</button>
            <button class="btn" style="background: #ff6b6b; color: white;" onclick="callRiichi()" id="riichiBtn">ãƒªãƒ¼ãƒ</button>
            <button class="btn btn-warning" onclick="callChi()" id="chiBtn">ãƒãƒ¼</button>
            <button class="btn btn-warning" onclick="callPon()" id="ponBtn">ãƒãƒ³</button>
            <button class="btn btn-warning" onclick="callKan()" id="kanBtn">ã‚«ãƒ³</button>
            <button class="btn btn-success" onclick="callTsumo()" id="tsumoBtn">ãƒ„ãƒ¢</button>
            <button class="btn btn-success" onclick="callRon()" id="ronBtn">ãƒ­ãƒ³</button>
            <button class="btn btn-info" onclick="executeAI()" id="aiBtn">AIå®Ÿè¡Œ</button>
        </div>
        
        <!-- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ« -->
        <div class="debug-panel" style="position: fixed; top: 120px; left: 20px; background: rgba(0,0,0,0.9); color: white; padding: 12px; border-radius: 8px; font-size: 0.8rem; z-index: 100; max-width: 200px;">
            <div style="font-weight: bold; margin-bottom: 8px;">ğŸ”§ ãƒ‡ãƒãƒƒã‚°æ“ä½œ</div>
            <div style="display: grid; grid-template-columns: 1fr; gap: 6px;">
                <button class="btn" style="background: #6c757d; color: white; padding: 4px 8px; font-size: 0.7rem;" onclick="forceCPUTurn()">CPUå¼·åˆ¶å®Ÿè¡Œ</button>
                <button class="btn" style="background: #6c757d; color: white; padding: 4px 8px; font-size: 0.7rem;" onclick="showGameLog()">ãƒ­ã‚°è¡¨ç¤º</button>
                <button class="btn" style="background: #6c757d; color: white; padding: 4px 8px; font-size: 0.7rem;" onclick="toggleDebugMode()">ãƒ‡ãƒãƒƒã‚°åˆ‡æ›¿</button>
                <button class="btn" style="background: #6c757d; color: white; padding: 4px 8px; font-size: 0.7rem;" onclick="skipToNextPlayer()">æ¬¡ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</button>
                <button class="btn" style="background: #6c757d; color: white; padding: 4px 8px; font-size: 0.7rem;" onclick="showDiscards()">æ¨ã¦ç‰Œç¢ºèª</button>
                <button class="btn" style="background: #6c757d; color: white; padding: 4px 8px; font-size: 0.7rem;" onclick="clearConsole()">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¶ˆå»</button>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥ -->
    <div class="notification" id="notification"></div>

    <!-- éŸ³åŠ¹åˆ¶å¾¡ãƒ‘ãƒãƒ« -->
    <div style="position: fixed; top: 10px; right: 10px; z-index: 1000; background: rgba(0,0,0,0.8); padding: 8px; border-radius: 6px; color: white;">
        <div style="display: flex; align-items: center; gap: 8px;">
            <button onclick="toggleSound()" id="soundToggle" class="btn" style="background: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">ğŸ”Š</button>
            <input type="range" id="volumeSlider" min="0" max="100" value="70" onchange="setVolume(this.value)" style="width: 60px;">
        </div>
    </div>

    <script src="/js/SoundManager.js"></script>
    <script>
        let gameId = null;
        let selectedTile = null;
        let gameState = null;
        let debugMode = false;

        // éŸ³åŠ¹åˆ¶å¾¡é–¢æ•°
        function toggleSound() {
            const isMuted = soundManager.toggleMute();
            const button = document.getElementById('soundToggle');
            button.textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
            button.style.background = isMuted ? '#dc3545' : '#28a745';
            showNotification(isMuted ? 'éŸ³åŠ¹ã‚’ãƒŸãƒ¥ãƒ¼ãƒˆã—ã¾ã—ãŸ' : 'éŸ³åŠ¹ã‚’æœ‰åŠ¹ã«ã—ã¾ã—ãŸ', 'info');
        }

        function setVolume(value) {
            soundManager.setVolume(value / 100);
            showNotification(`éŸ³é‡: ${value}%`, 'info');
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸ” DEBUG: DOM loaded, initializing...');
            try {
                await soundManager.init();
                console.log('ğŸ” DEBUG: SoundManager initialized');
            } catch (error) {
                console.warn('ğŸ” DEBUG: SoundManager init failed:', error);
            }
            
            newGame();
            
            try {
                soundManager.playGameStart();
            } catch (error) {
                console.warn('ğŸ” DEBUG: playGameStart failed:', error);
            }
        });

        // æ–°ã—ã„ã‚²ãƒ¼ãƒ ä½œæˆ
        async function newGame() {
            try {
                showNotification('æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’ä½œæˆä¸­...', 'info');
                
                const response = await fetch('/api/game/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.status === 'OK') {
                    gameId = result.data.gameId;
                    gameState = result.data.gameState;
                    updateGameDisplay();
                    showNotification('ã‚²ãƒ¼ãƒ ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸï¼', 'success');
                } else {
                    showNotification('ã‚²ãƒ¼ãƒ ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                console.error('Game creation error:', error);
                showNotification('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
            }
        }

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹æ›´æ–°
        function updateGameDisplay() {
            if (!gameState) {
                console.log('ğŸ” DEBUG: gameState is null or undefined');
                return;
            }

            console.log('ğŸ” DEBUG: updateGameDisplay called');
            console.log('ğŸ” DEBUG: gameState:', gameState);
            console.log('ğŸ” DEBUG: gameState.players:', gameState.players);
            console.log('ğŸ” DEBUG: gameState.currentPlayer:', gameState.currentPlayer);

            // åŸºæœ¬æƒ…å ±æ›´æ–°
            try {
                document.getElementById('currentPlayer').textContent = gameState.currentPlayer || '0';
                
                const currentPlayerName = gameState.players && gameState.players[gameState.currentPlayer] 
                    ? gameState.players[gameState.currentPlayer].name 
                    : 'Unknown';
                document.getElementById('currentPlayerName').textContent = currentPlayerName;
                console.log('ğŸ” DEBUG: currentPlayerName:', currentPlayerName);
                document.getElementById('remainingTiles').textContent = gameState.remainingTiles || '0';
                document.getElementById('remainingTilesInfo').textContent = gameState.remainingTiles || '0';
                
                if (gameState.round) {
                    document.getElementById('round').textContent = gameState.round.roundNumber || '1';
                    document.getElementById('honba').textContent = gameState.round.honbaCount || '0';
                    document.getElementById('roundInfo').textContent = `æ±${gameState.round.roundNumber || '1'}å±€ ${gameState.round.honbaCount || '0'}æœ¬å ´`;
                    document.getElementById('gameInfo').textContent = `æ±å ´ ${gameState.round.roundNumber || '1'}å±€`;
                }
                
                document.getElementById('doraIndicator').textContent = gameState.doraIndicators?.[0]?.unicode || 'ğŸ€«';
                
                console.log('ğŸ” DEBUG: Basic info updated successfully');
            } catch (error) {
                console.error('ğŸ” DEBUG: Error updating basic info:', error);
            }

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±æ›´æ–°
            try {
                console.log('ğŸ” DEBUG: Starting player info update');
                if (!gameState.players || !Array.isArray(gameState.players)) {
                    console.error('ğŸ” DEBUG: gameState.players is not an array:', gameState.players);
                    return;
                }
                
                gameState.players.forEach((player, index) => {
                    console.log(`ğŸ” DEBUG: Processing player ${index}:`, player);
                    const playerElement = document.getElementById(`player${index}`);
                    if (!playerElement) {
                        console.warn(`ğŸ” DEBUG: Player element not found: player${index}`);
                        return;
                    }

                // ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                if (index === gameState.currentPlayer) {
                    playerElement.classList.add('current');
                } else {
                    playerElement.classList.remove('current');
                }

                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±æ›´æ–°
                const nameElement = playerElement.querySelector('.player-name');
                const windElement = playerElement.querySelector('.player-wind');
                
                if (nameElement) nameElement.textContent = player.name;
                if (windElement) windElement.textContent = player.wind;

                    // æ‰‹ç‰Œæ›´æ–°
                    const handElement = document.getElementById(`hand${index}`);
                    console.log(`ğŸ” DEBUG: handElement for player ${index}:`, handElement);
                    console.log(`ğŸ” DEBUG: player.hand for player ${index}:`, player.hand);
                    console.log(`ğŸ” DEBUG: player.hand.tiles for player ${index}:`, player.hand?.tiles);
                    
                    if (handElement && player.hand && player.hand.tiles) {
                        handElement.innerHTML = '';
                        
                        if (index === 0) {
                            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰‹ç‰Œï¼ˆè¡¨ç¤ºï¼‰
                            console.log(`ğŸ” DEBUG: Updating player 0 hand with ${player.hand.tiles.length} tiles`);
                            player.hand.tiles.forEach((tile, tileIndex) => {
                                const tileElement = document.createElement('div');
                                tileElement.className = 'tile';
                                if (tile.isRed) tileElement.classList.add('red');
                                tileElement.textContent = tile.displayName || tile.unicode;
                                tileElement.onclick = () => selectTile(index, tileIndex, tile);
                                handElement.appendChild(tileElement);
                            });
                            
                            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è©³ç´°æƒ…å ±æ›´æ–°
                            document.getElementById('handCount').textContent = player.hand.tiles.length;
                            document.getElementById('playerName').textContent = player.name;
                            document.getElementById('playerScore').textContent = player.score;
                            document.getElementById('playerWind').textContent = player.wind;
                            console.log(`ğŸ” DEBUG: Player 0 hand updated successfully with ${player.hand.tiles.length} tiles`);
                        } else {
                            // å¯¾æˆ¦ç›¸æ‰‹ã®æ‰‹ç‰Œï¼ˆè£å‘ãï¼‰
                            console.log(`ğŸ” DEBUG: Updating opponent ${index} hand with ${player.hand.tiles.length} hidden tiles`);
                            for (let i = 0; i < player.hand.tiles.length; i++) {
                                const tileElement = document.createElement('div');
                                tileElement.className = 'opponent-tile';
                                tileElement.textContent = 'ğŸ€«';
                                handElement.appendChild(tileElement);
                            }
                        }
                    } else {
                        console.warn(`ğŸ” DEBUG: Cannot update hand for player ${index} - missing handElement or tiles`);
                    }
                });
                
                console.log('ğŸ” DEBUG: Player info update completed');
            } catch (error) {
                console.error('ğŸ” DEBUG: Error updating player info:', error);
            }

            // å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ²³æ›´æ–°ï¼ˆæœ¬æ ¼éº»é›€ä»•æ§˜ï¼‰
            if (gameState.players) {
                gameState.players.forEach((player, playerIndex) => {
                    const riverElement = document.getElementById(`river${playerIndex}`);
                    if (riverElement && player.hand && player.hand.discards) {
                        riverElement.innerHTML = '';
                        
                        player.hand.discards.forEach((tile, discardIndex) => {
                            const tileElement = document.createElement('div');
                            tileElement.className = 'river-tile';
                            
                            // èµ¤ç‰Œå‡¦ç†
                            if (tile.isRed) tileElement.classList.add('red');
                            
                            // ãƒªãƒ¼ãƒå®£è¨€ç‰Œã¯æ¨ªå‘ã
                            if (player.hand.riichi && player.hand.riichiTile && 
                                isSameTile(tile, player.hand.riichiTile)) {
                                tileElement.classList.add('reach');
                            }
                            
                            tileElement.textContent = tile.displayName || tile.unicode;
                            
                            // 6Ã—3ã‚°ãƒªãƒƒãƒ‰ã®é…ç½®é †åº
                            const gridOrder = calculateRiverOrder(playerIndex, discardIndex);
                            tileElement.style.order = gridOrder;
                            
                            riverElement.appendChild(tileElement);
                        });
                    }
                });
            }

            // ã‚²ãƒ¼ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
            updateGameStatus();
        }

        // æ²³ã®é…ç½®é †åºè¨ˆç®—ï¼ˆæœ¬æ ¼éº»é›€ä»•æ§˜ï¼‰
        function calculateRiverOrder(playerIndex, discardIndex) {
            // 6Ã—3ã®ã‚°ãƒªãƒƒãƒ‰ã§ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã«æ¨ç‰Œã®å‘ããŒç•°ãªã‚‹
            const row = Math.floor(discardIndex / 6);
            const col = discardIndex % 6;
            
            switch (playerIndex) {
                case 0: // ä¸‹éƒ¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆè‡ªåˆ†ï¼‰ï¼šå·¦ã‹ã‚‰å³ã€ä¸Šã‹ã‚‰ä¸‹
                    return row * 6 + col;
                case 1: // å·¦ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼šä¸Šã‹ã‚‰ä¸‹ã€å·¦ã‹ã‚‰å³ï¼ˆ3Ã—6ï¼‰
                    return Math.floor(discardIndex / 3) * 3 + (discardIndex % 3);
                case 2: // ä¸Šéƒ¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼šå³ã‹ã‚‰å·¦ã€ä¸‹ã‹ã‚‰ä¸Š
                    return (2 - row) * 6 + (5 - col);
                case 3: // å³ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼šä¸‹ã‹ã‚‰ä¸Šã€å³ã‹ã‚‰å·¦ï¼ˆ3Ã—6ï¼‰
                    return (5 - Math.floor(discardIndex / 3)) * 3 + (2 - (discardIndex % 3));
                default:
                    return discardIndex;
            }
        }
        
        // ç‰ŒãŒåŒã˜ã‹ãƒã‚§ãƒƒã‚¯
        function isSameTile(tile1, tile2) {
            if (!tile1 || !tile2) return false;
            if (tile1.suit !== tile2.suit) return false;
            if (tile1.suit === 'ji') {
                return tile1.honor === tile2.honor;
            }
            return tile1.rank === tile2.rank;
        }

        // ã‚²ãƒ¼ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updateGameStatus() {
            const statusElement = document.getElementById('gameStatus');
            if (!gameState || !statusElement) return;

            const currentPlayerName = gameState.players[gameState.currentPlayer]?.name;
            const playerHand = gameState.players[0].hand.tiles;
            const handCount = playerHand ? playerHand.length : 0;
            const isMyTurn = gameState.currentPlayer === 0;
            
            let statusText = `${currentPlayerName}ã®ã‚¿ãƒ¼ãƒ³`;
            if (isMyTurn) {
                if (handCount === 13) {
                    statusText = 'ãƒ„ãƒ¢ã—ã¦ãã ã•ã„';
                } else if (handCount === 14) {
                    statusText = 'æ‰“ç‰Œã—ã¦ãã ã•ã„';
                }
            }
            
            statusElement.textContent = statusText;
            statusElement.style.color = isMyTurn ? '#28a745' : '#6c757d';
        }

        // ç‰Œé¸æŠ
        function selectTile(playerIndex, tileIndex, tile) {
            if (playerIndex !== 0) {
                showNotification('è‡ªåˆ†ã®ç‰Œã®ã¿é¸æŠã§ãã¾ã™', 'warning');
                return;
            }
            
            if (gameState && gameState.currentPlayer !== 0) {
                showNotification('ã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³ã§ã¯ã‚ã‚Šã¾ã›ã‚“', 'warning');
                return;
            }

            // é¸æŠè§£é™¤
            document.querySelectorAll('.tile.selected').forEach(t => t.classList.remove('selected'));

            // æ—¢ã«é¸æŠã•ã‚Œã¦ã„ã‚‹ç‰Œã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯æ‰“ç‰Œ
            if (selectedTile && selectedTile.tileIndex === tileIndex && selectedTile.tile.id === tile.id) {
                discardSelected();
                return;
            }

            // æ–°ã—ã„ç‰Œã‚’é¸æŠ
            selectedTile = { playerIndex, tileIndex, tile };
            document.getElementById('hand0').children[tileIndex].classList.add('selected');
            soundManager.playSound('tileSelect');
            showNotification(`${tile.displayName || tile.unicode} ã‚’é¸æŠï¼ˆå†ã‚¯ãƒªãƒƒã‚¯ã§æ‰“ç‰Œï¼‰`, 'info');
        }

        // æ‰“ç‰Œå‡¦ç†
        async function discardSelected() {
            if (!selectedTile || !gameId) {
                showNotification('ç‰Œã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                return;
            }

            try {
                const response = await fetch(`/api/game/${gameId}/action`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'discard',
                        playerId: 'player_0',
                        tileId: selectedTile.tile.id
                    })
                });

                const result = await response.json();
                
                if (result.status === 'OK') {
                    gameState = result.data.gameState;
                    selectedTile = null;
                    updateGameDisplay();
                    soundManager.playSound('tilePlace');
                    showNotification('æ‰“ç‰Œã—ã¾ã—ãŸ', 'success');
                } else {
                    showNotification(result.message || 'æ‰“ç‰Œã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                console.error('Discard error:', error);
                showNotification('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
            }
        }

        // ãƒ„ãƒ¢å‡¦ç†
        async function drawTile() {
            if (!gameId) return;
            
            try {
                const response = await fetch(`/api/game/${gameId}/action`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: 'draw',
                        playerId: 'player_0'
                    })
                });

                const result = await response.json();
                if (result.status === 'OK') {
                    gameState = result.data.gameState;
                    updateGameDisplay();
                    soundManager.playSound('tilePlace');
                    showNotification('ãƒ„ãƒ¢ã—ã¾ã—ãŸ', 'success');
                } else {
                    showNotification(result.message || 'ãƒ„ãƒ¢ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                console.error('Draw error:', error);
                showNotification('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
            }
        }

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹å–å¾—
        async function requestGameState() {
            if (!gameId) return;
            
            try {
                const response = await fetch(`/api/game/${gameId}`);
                const result = await response.json();
                
                if (result.status === 'OK') {
                    console.log('ğŸ” DEBUG: API response:', result);
                    // APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ§‹é€ ã«å¿œã˜ã¦é©åˆ‡ã«gameStateã‚’è¨­å®š
                    if (result.data.gameState) {
                        gameState = result.data.gameState;
                    } else {
                        gameState = result.data;
                    }
                    console.log('ğŸ” DEBUG: Set gameState to:', gameState);
                    updateGameDisplay();
                    showNotification('çŠ¶æ…‹ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
                } else {
                    showNotification('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                console.error('Game state error:', error);
                showNotification('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
            }
        }

        // AIå®Ÿè¡Œ
        async function executeAI() {
            if (!gameId) return;
            
            try {
                const response = await fetch(`/api/game/${gameId}/ai`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                if (result.status === 'OK') {
                    gameState = result.data.gameState;
                    updateGameDisplay();
                    soundManager.playSound('tilePlace');
                    showNotification(result.message || 'AI ãŒè¡Œå‹•ã—ã¾ã—ãŸ', 'success');
                } else {
                    showNotification(result.message || 'AIå®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                console.error('AI error:', error);
                showNotification('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
            }
        }

        // é³´ãé–¢æ•°
        // ãƒãƒ¼
        function callChi() {
            if (!gameState || gameState.currentPlayer === 0) {
                showNotification('ãƒãƒ¼ã§ãã¾ã›ã‚“', 'error');
                return;
            }
            
            performAction('chi', {}, (result) => {
                if (result.success) {
                    showNotification('ãƒãƒ¼ã—ã¾ã—ãŸ', 'success');
                    requestGameState();
                } else {
                    showNotification(`ãƒãƒ¼ã§ãã¾ã›ã‚“: ${result.error}`, 'error');
                }
            });
        }

        // ãƒãƒ³
        function callPon() {
            if (!gameState || gameState.currentPlayer === 0) {
                showNotification('ãƒãƒ³ã§ãã¾ã›ã‚“', 'error');
                return;
            }
            
            performAction('pon', {}, (result) => {
                if (result.success) {
                    showNotification('ãƒãƒ³ã—ã¾ã—ãŸ', 'success');
                    requestGameState();
                } else {
                    showNotification(`ãƒãƒ³ã§ãã¾ã›ã‚“: ${result.error}`, 'error');
                }
            });
        }

        // ã‚«ãƒ³
        function callKan() {
            if (!gameState || gameState.currentPlayer === 0) {
                showNotification('ã‚«ãƒ³ã§ãã¾ã›ã‚“', 'error');
                return;
            }
            
            performAction('kan', {}, (result) => {
                if (result.success) {
                    showNotification('ã‚«ãƒ³ã—ã¾ã—ãŸ', 'success');
                    requestGameState();
                } else {
                    showNotification(`ã‚«ãƒ³ã§ãã¾ã›ã‚“: ${result.error}`, 'error');
                }
            });
        }

        // ãƒ„ãƒ¢å’Œäº†
        function callTsumo() {
            if (!gameState || gameState.currentPlayer !== 0) {
                showNotification('ãƒ„ãƒ¢ã§ãã¾ã›ã‚“ï¼ˆã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰', 'error');
                return;
            }
            
            performAction('tsumo', {}, (result) => {
                if (result.success) {
                    showNotification('ãƒ„ãƒ¢å’Œäº†ï¼', 'success');
                    if (result.data && result.data.score) {
                        showNotification(`ç²å¾—ç‚¹æ•°: ${result.data.score.total}ç‚¹`, 'info');
                    }
                    requestGameState();
                } else {
                    showNotification(`ãƒ„ãƒ¢ã§ãã¾ã›ã‚“: ${result.error}`, 'error');
                }
            });
        }

        // ãƒ­ãƒ³å’Œäº†
        function callRon() {
            if (!gameState || gameState.currentPlayer === 0) {
                showNotification('ãƒ­ãƒ³ã§ãã¾ã›ã‚“', 'error');
                return;
            }
            
            performAction('ron', {}, (result) => {
                if (result.success) {
                    showNotification('ãƒ­ãƒ³å’Œäº†ï¼', 'success');
                    if (result.data && result.data.score) {
                        showNotification(`ç²å¾—ç‚¹æ•°: ${result.data.score.total}ç‚¹`, 'info');
                    }
                    requestGameState();
                } else {
                    showNotification(`ãƒ­ãƒ³ã§ãã¾ã›ã‚“: ${result.error}`, 'error');
                }
            });
        }

        // ãƒªãƒ¼ãƒ
        function callRiichi() {
            if (!gameState || gameState.currentPlayer !== 0) {
                showNotification('ãƒªãƒ¼ãƒã§ãã¾ã›ã‚“ï¼ˆã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰', 'error');
                return;
            }
            
            performAction('riichi', {}, (result) => {
                if (result.success) {
                    showNotification('ãƒªãƒ¼ãƒï¼', 'success');
                    requestGameState();
                } else {
                    showNotification(`ãƒªãƒ¼ãƒã§ãã¾ã›ã‚“: ${result.error}`, 'error');
                }
            });
        }

        function toggleDebug() {
            debugMode = !debugMode;
            showNotification(debugMode ? 'ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ON' : 'ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰OFF', 'info');
        }

        // ãƒ‡ãƒãƒƒã‚°é–¢æ•°ç¾¤
        function forceCPUTurn() {
            if (!gameState) {
                showNotification('ã‚²ãƒ¼ãƒ çŠ¶æ…‹ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            const currentPlayer = gameState.players[gameState.currentPlayer];
            if (currentPlayer && currentPlayer.name.includes('CPU')) {
                executeAI();
                showNotification(`${currentPlayer.name}ã®ã‚¿ãƒ¼ãƒ³ã‚’å¼·åˆ¶å®Ÿè¡Œ`, 'info');
            } else {
                showNotification('ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯CPUã§ã¯ã‚ã‚Šã¾ã›ã‚“', 'warning');
            }
        }

        function showGameLog() {
            if (!gameState || !gameState.gameLog) {
                console.log('ğŸ“‹ ã‚²ãƒ¼ãƒ ãƒ­ã‚°: ãªã—');
                showNotification('ã‚²ãƒ¼ãƒ ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“', 'warning');
                return;
            }
            console.log('ğŸ“‹ ã‚²ãƒ¼ãƒ ãƒ­ã‚°:', gameState.gameLog);
            console.log('ğŸ“‹ ã‚²ãƒ¼ãƒ ãƒ­ã‚°è©³ç´°:');
            gameState.gameLog.forEach((log, index) => {
                console.log(`  ${index + 1}. [${log.type}] ${log.description}`, log);
            });
            showNotification(`ã‚²ãƒ¼ãƒ ãƒ­ã‚°ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º (${gameState.gameLog.length}ä»¶)`, 'info');
        }

        function toggleDebugMode() {
            debugMode = !debugMode;
            showNotification(debugMode ? 'ğŸ”§ ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ON' : 'ğŸ”§ ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰OFF', 'info');
        }

        function skipToNextPlayer() {
            if (!gameState) {
                showNotification('ã‚²ãƒ¼ãƒ çŠ¶æ…‹ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            const nextPlayer = (gameState.currentPlayer + 1) % 4;
            console.log(`â­ï¸ æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å¼·åˆ¶ç§»è¡Œ: ${gameState.currentPlayer} â†’ ${nextPlayer}`);
            showNotification(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${nextPlayer}ã®ã‚¿ãƒ¼ãƒ³ã«ç§»è¡Œ`, 'info');
        }

        function showDiscards() {
            if (!gameState) {
                showNotification('ã‚²ãƒ¼ãƒ çŠ¶æ…‹ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            console.log('ğŸ—‚ï¸ æ¨ã¦ç‰Œæƒ…å ±:');
            gameState.players.forEach((player, index) => {
                console.log(`  ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${index} (${player.name}): `, player.hand.discards);
            });
            if (gameState.gameLog) {
                const discardLogs = gameState.gameLog.filter(log => log.type === 'discard');
                console.log(`ğŸ—‚ï¸ ã‚²ãƒ¼ãƒ ãƒ­ã‚°å†…ã®æ¨ã¦ç‰Œ: ${discardLogs.length}ä»¶`, discardLogs);
            }
            showNotification('æ¨ã¦ç‰Œæƒ…å ±ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º', 'info');
        }

        function clearConsole() {
            console.clear();
            showNotification('ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
        }

        // é€šçŸ¥è¡¨ç¤º
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', function(e) {
            if (e.key === 'd' || e.key === 'D') drawTile();
            if (e.key === 's' || e.key === 'S') discardSelected();
            if (e.key === 'a' || e.key === 'A') executeAI();
            if (e.key === 'r' || e.key === 'R') requestGameState();
            if (e.key === 'n' || e.key === 'N') newGame();
            if (e.key === 'q' || e.key === 'Q') toggleDebug();
        });

        // è‡ªå‹•æ›´æ–°ï¼ˆ10ç§’ã”ã¨ï¼‰
        setInterval(() => {
            if (gameId) {
                requestGameState();
            }
        }, 10000);
    </script>
</body>
</html>