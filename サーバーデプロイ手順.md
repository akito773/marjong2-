# ã•ãã‚‰VPS ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ãƒ†ã‚¹ãƒˆæ‰‹é †æ›¸

## 1. ã•ãã‚‰VPSç’°å¢ƒæº–å‚™

### 1.1 å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
# Node.js ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆNodeSourceçµŒç”±ï¼‰
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# PM2 ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo npm install -g pm2

# Nginx ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ç”¨ï¼‰
sudo apt update
sudo apt install -y nginx

# Git ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæ—¢ã«ã‚ã‚‹å ´åˆã¯ä¸è¦ï¼‰
sudo apt install -y git
```

### 1.2 ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š
```bash
# UFW ã®æœ‰åŠ¹åŒ–ã¨ãƒãƒ¼ãƒˆé–‹æ”¾
sudo ufw enable
sudo ufw allow 22      # SSH
sudo ufw allow 80      # HTTP
sudo ufw allow 443     # HTTPS
sudo ufw allow 3000    # Node.jsé–‹ç™ºç”¨ï¼ˆå¾Œã§é–‰ã˜ã‚‹ï¼‰
```

## 2. Hello World ãƒ†ã‚¹ãƒˆç”¨æœ€å°æ§‹æˆ

### 2.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
```
marjong2/
â”œâ”€â”€ package.json
â”œâ”€â”€ server.js           # æœ€å°é™ã®Expressã‚µãƒ¼ãƒãƒ¼
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.html      # Hello Worldãƒšãƒ¼ã‚¸
â””â”€â”€ ecosystem.config.js # PM2è¨­å®š
```

### 2.2 æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ä¾‹

#### package.json
```json
{
  "name": "marjong2-test",
  "version": "0.1.0",
  "description": "éº»é›€ã‚²ãƒ¼ãƒ  Hello World ãƒ†ã‚¹ãƒˆ",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "node server.js"
  },
  "dependencies": {
    "express": "^4.18.2"
  }
}
```

#### server.js
```javascript
const express = require('express');
const path = require('path');

const app = express();
const PORT = process.env.PORT || 3000;

// é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ä¿¡
app.use(express.static('public'));

// ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹
app.get('/', (req, res) => {
  res.sendFile(path.join(__dirname, 'public', 'index.html'));
});

// ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç”¨API
app.get('/api/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    message: 'éº»é›€ã‚²ãƒ¼ãƒ ã‚µãƒ¼ãƒãƒ¼ãŒå‹•ä½œä¸­ã§ã™',
    timestamp: new Date().toISOString()
  });
});

app.listen(PORT, () => {
  console.log(`ã‚µãƒ¼ãƒãƒ¼ãŒãƒãƒ¼ãƒˆ ${PORT} ã§èµ·å‹•ã—ã¾ã—ãŸ`);
  console.log(`http://localhost:${PORT} ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™`);
});
```

#### public/index.html
```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éº»é›€ã‚²ãƒ¼ãƒ  - Hello World</title>
    <style>
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            text-align: center;
            padding: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { font-size: 3em; margin-bottom: 30px; }
        .status { 
            background: rgba(255,255,255,0.1); 
            padding: 20px; 
            border-radius: 10px; 
            margin: 20px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ€„ éº»é›€ã‚²ãƒ¼ãƒ </h1>
        <h2>Hello World!</h2>
        
        <div class="status">
            <p><strong>ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šãƒ†ã‚¹ãƒˆ</strong></p>
            <p id="server-status">æ¥ç¶šç¢ºèªä¸­...</p>
            <button onclick="checkServer()">ã‚µãƒ¼ãƒãƒ¼ç¢ºèª</button>
        </div>
        
        <div class="status">
            <p><strong>ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºèª</strong></p>
            <p>âœ… HTMLãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æˆåŠŸ</p>
            <p>âœ… CSSã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨æˆåŠŸ</p>
            <p id="js-status">âœ… JavaScriptå‹•ä½œç¢ºèª</p>
        </div>
    </div>

    <script>
        // JavaScriptå‹•ä½œç¢ºèª
        document.getElementById('js-status').textContent = 'âœ… JavaScriptå‹•ä½œæˆåŠŸ';
        
        // ã‚µãƒ¼ãƒãƒ¼APIç¢ºèª
        async function checkServer() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                document.getElementById('server-status').innerHTML = 
                    `âœ… ${data.message}<br>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—: ${data.timestamp}`;
            } catch (error) {
                document.getElementById('server-status').textContent = 
                    'âŒ ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚µãƒ¼ãƒãƒ¼ç¢ºèª
        window.onload = () => {
            setTimeout(checkServer, 1000);
        };
    </script>
</body>
</html>
```

#### ecosystem.config.jsï¼ˆPM2è¨­å®šï¼‰
```javascript
module.exports = {
  apps: [{
    name: 'marjong2-test',
    script: 'server.js',
    instances: 1,
    exec_mode: 'fork',
    env: {
      PORT: 3000,
      NODE_ENV: 'production'
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true
  }]
};
```

## 3. ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### 3.1 ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®äº‹å‰ãƒ†ã‚¹ãƒˆ
```bash
# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm start

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ç¢ºèª
```

### 3.2 ã•ãã‚‰VPSã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ–¹æ³•

#### æ–¹æ³•A: GitçµŒç”±ï¼ˆæ¨å¥¨ï¼‰
```bash
# VPSã«SSHãƒ­ã‚°ã‚¤ãƒ³
ssh username@your-server-ip

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p /var/www/marjong2
cd /var/www/marjong2

# Gitãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã‚¯ãƒ­ãƒ¼ãƒ³ï¼ˆGitHubã«ãƒ—ãƒƒã‚·ãƒ¥å¾Œï¼‰
git clone https://github.com/yourusername/marjong2.git .

# ã¾ãŸã¯ã€Gitãƒªãƒã‚¸ãƒˆãƒªã‚’ç›´æ¥åˆæœŸåŒ–ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ãƒ—ãƒƒã‚·ãƒ¥
```

#### æ–¹æ³•B: SCP/rsyncçµŒç”±
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰VPSã«ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€
scp -r /home/ak/marjong2/* username@your-server-ip:/var/www/marjong2/

# ã¾ãŸã¯ rsyncä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰
rsync -avz --exclude node_modules /home/ak/marjong2/ username@your-server-ip:/var/www/marjong2/
```

### 3.3 VPSä¸Šã§ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# VPSã«SSHãƒ­ã‚°ã‚¤ãƒ³
ssh username@your-server-ip

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd /var/www/marjong2

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p logs

# PM2ã§ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
pm2 start ecosystem.config.js

# PM2ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª
pm2 list

# PM2ã‚’è‡ªå‹•èµ·å‹•ã«è¨­å®š
pm2 startup
pm2 save
```

## 4. Nginxãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### 4.1 Nginxè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
sudo nano /etc/nginx/sites-available/marjong2
```

```nginx
server {
    listen 80;
    server_name your-domain.com;  # ã¾ãŸã¯ IPã‚¢ãƒ‰ãƒ¬ã‚¹
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 4.2 Nginxè¨­å®šã®æœ‰åŠ¹åŒ–
```bash
# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ä½œæˆ
sudo ln -s /etc/nginx/sites-available/marjong2 /etc/nginx/sites-enabled/

# è¨­å®šãƒ†ã‚¹ãƒˆ
sudo nginx -t

# Nginxå†èµ·å‹•
sudo systemctl restart nginx
```

## 5. ãƒ†ã‚¹ãƒˆç¢ºèªæ‰‹é †

### 5.1 åŸºæœ¬å‹•ä½œç¢ºèª
1. **ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹**: `http://your-server-ip` ã¾ãŸã¯ `http://your-domain.com`
2. **Hello Worldãƒšãƒ¼ã‚¸è¡¨ç¤ºç¢ºèª**
3. **ã€Œã‚µãƒ¼ãƒãƒ¼ç¢ºèªã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯**
4. **APIå¿œç­”ç¢ºèª**

### 5.2 ãƒ­ã‚°ç¢ºèª
```bash
# PM2ãƒ­ã‚°ç¢ºèª
pm2 logs marjong2-test

# Nginxãƒ­ã‚°ç¢ºèªï¼ˆä½¿ç”¨æ™‚ï¼‰
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### 5.3 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
```bash
# ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª
pm2 list
ps aux | grep node

# ãƒãƒ¼ãƒˆç¢ºèª
sudo netstat -tlnp | grep :3000

# ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ç¢ºèª
sudo ufw status
```

## 6. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

Hello WorldãŒæ­£å¸¸ã«å‹•ä½œã—ãŸã‚‰ï¼š
1. **ãƒ•ã‚§ãƒ¼ã‚º1ã®æœ¬æ ¼çš„ãªé–‹ç™ºç’°å¢ƒæ§‹ç¯‰**
2. **TypeScript + Reactç’°å¢ƒã®è¿½åŠ **
3. **Socket.IOé€šä¿¡ãƒ†ã‚¹ãƒˆ**
4. **ç¶™ç¶šçš„ãƒ‡ãƒ—ãƒ­ã‚¤ã®è‡ªå‹•åŒ–**

---

ã¾ãšã¯ã“ã®æœ€å°æ§‹æˆã§ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ—ãƒ­ã‚¤ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚å•é¡ŒãŒã‚ã‚Œã°è©³ç´°ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚